<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>两句css 搞定页面滚动时的卡顿问题 | Tager Blog</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link rel="icon" href="/blog/logo.jpg">
    <meta name="description" content="与其临渊羡鱼，不如退而结网">
    <link rel="preload" href="/blog/assets/css/0.styles.15ee3217.css" as="style"><link rel="preload" href="/blog/assets/js/app.639cd58a.js" as="script"><link rel="preload" href="/blog/assets/js/2.625d0afc.js" as="script"><link rel="preload" href="/blog/assets/js/4.3bde02cb.js" as="script"><link rel="preload" href="/blog/assets/js/5.ec6cd246.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.ad34d0e2.js"><link rel="prefetch" href="/blog/assets/js/11.86b62e11.js"><link rel="prefetch" href="/blog/assets/js/12.11d0964a.js"><link rel="prefetch" href="/blog/assets/js/13.be2e4cc4.js"><link rel="prefetch" href="/blog/assets/js/14.a5f108e2.js"><link rel="prefetch" href="/blog/assets/js/15.fe435834.js"><link rel="prefetch" href="/blog/assets/js/16.5ae83134.js"><link rel="prefetch" href="/blog/assets/js/17.44ade0e2.js"><link rel="prefetch" href="/blog/assets/js/18.95cb9ad3.js"><link rel="prefetch" href="/blog/assets/js/19.6b6f4cbc.js"><link rel="prefetch" href="/blog/assets/js/20.7f54f489.js"><link rel="prefetch" href="/blog/assets/js/21.62ecc5d0.js"><link rel="prefetch" href="/blog/assets/js/22.aa507bd1.js"><link rel="prefetch" href="/blog/assets/js/23.95fca3a7.js"><link rel="prefetch" href="/blog/assets/js/24.6b5446d8.js"><link rel="prefetch" href="/blog/assets/js/25.5031aa6c.js"><link rel="prefetch" href="/blog/assets/js/26.a0daed16.js"><link rel="prefetch" href="/blog/assets/js/27.d607893a.js"><link rel="prefetch" href="/blog/assets/js/3.5d8fd5d2.js"><link rel="prefetch" href="/blog/assets/js/6.3996e9ad.js"><link rel="prefetch" href="/blog/assets/js/7.1d1ccad0.js"><link rel="prefetch" href="/blog/assets/js/8.e5ff8b58.js"><link rel="prefetch" href="/blog/assets/js/9.2417f7ac.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.15ee3217.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Tager Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端栈" class="dropdown-title"><span class="title">前端栈</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端栈" class="mobile-dropdown-title"><span class="title">前端栈</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/javascript/debounce.html" class="nav-link">
  Javascript
</a></li><li class="dropdown-item"><!----> <a href="/blog/nodejs/" class="nav-link">
  NodeJs
</a></li><li class="dropdown-item"><!----> <a href="/blog/backend/httpStatus.html" class="nav-link">
  backend
</a></li><li class="dropdown-item"><!----> <a href="/blog/graph/" class="nav-link">
  Graph
</a></li><li class="dropdown-item"><!----> <a href="/blog/performance/render.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  前端性能优化
</a></li><li class="dropdown-item"><!----> <a href="/blog/sublime/sublime.html" class="nav-link">
  高效编辑器
</a></li></ul></div></div> <a href="https://github.com/wangtager/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端栈" class="dropdown-title"><span class="title">前端栈</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端栈" class="mobile-dropdown-title"><span class="title">前端栈</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/javascript/debounce.html" class="nav-link">
  Javascript
</a></li><li class="dropdown-item"><!----> <a href="/blog/nodejs/" class="nav-link">
  NodeJs
</a></li><li class="dropdown-item"><!----> <a href="/blog/backend/httpStatus.html" class="nav-link">
  backend
</a></li><li class="dropdown-item"><!----> <a href="/blog/graph/" class="nav-link">
  Graph
</a></li><li class="dropdown-item"><!----> <a href="/blog/performance/render.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  前端性能优化
</a></li><li class="dropdown-item"><!----> <a href="/blog/sublime/sublime.html" class="nav-link">
  高效编辑器
</a></li></ul></div></div> <a href="https://github.com/wangtager/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Javascript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>NodeJs</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>常用的后端知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>图形动画</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>前端性能优化</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/performance/render.html" aria-current="page" class="active sidebar-link">两句css 搞定页面滚动时的卡顿问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/performance/render.html#首先着手优化js-相关部分" class="sidebar-link">首先着手优化js 相关部分</a></li><li class="sidebar-sub-header"><a href="/blog/performance/render.html#两句css-搞定页面滚动时的卡顿问题-2" class="sidebar-link">两句css 搞定页面滚动时的卡顿问题</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>高效编辑器</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="两句css-搞定页面滚动时的卡顿问题"><a href="#两句css-搞定页面滚动时的卡顿问题" class="header-anchor">#</a> 两句css 搞定页面滚动时的卡顿问题</h1> <div class="pv_count">浏览量：<span></span></div> <div class="language- line-numbers-mode"><pre class="language-text"><code>由于业务要求需要长列表渲染(不能做动态加载和虚拟列表)，
列表数据过多时滚动条的scrollTop达到5w+ ,
同时页面中的一些元素通过websocket实时更新。
在首屏加载、页面滚动、筛选等交互时，页面发生比较严重的卡顿问题
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="首先着手优化js-相关部分"><a href="#首先着手优化js-相关部分" class="header-anchor">#</a> 首先着手优化js 相关部分</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>1. 筛选部分服务端渲染，
2. 低频使用的隐藏元素全部v-if ,
3.  列表元素标签尽可能减少,
4.  部分交互方法优化，部分jquery 原生化 ，
5.  Vue computed 中高频触发的方法写到vuex中按需触发(服务端渲染时也需要使用)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>优化过后整体性能有所提升，但是当列表数量较多时，滚动列表还是能感受到明显的卡顿。</p> <hr> <h2 id="两句css-搞定页面滚动时的卡顿问题-2"><a href="#两句css-搞定页面滚动时的卡顿问题-2" class="header-anchor">#</a> 两句css 搞定页面滚动时的卡顿问题</h2> <p>其实页面卡顿就是一种用户体验，怎样评判这种体验的好坏了，根据<code>FPS(frame per second)</code>，即一秒之间能够完成多少次重新渲染，显示器的刷新频率一般是60Hz(在
电脑的显示设置中可查)，浏览器会自动按照这个频率刷新动画。每帧渲染的时间不能超过16.66ms(1000ms/60), 在实际开发中30fps-60fps 页面都会比较流畅。</p> <p>下面通过 <code>chrome devtool</code> 排查卡顿问题，在<code>Performance</code> 面板记录了操作10s 的耗时：</p> <p><img src="/blog/assets/img/1.22be84bd.png" alt="performance"></p> <p>在浏览器中通过 frames可以非常清晰的看到每帧的用时，用时最长的一帧将近<strong>1s(远大于16.67ms)</strong>。</p> <p>如上图，<code>update layer tree</code>和<code>Paint</code> 占用了71.2%的时间， 这个是啥？为什么会这么耗时了？从字面上看意思是更新层树和绘制，实际上就是我们前端程序猿耳熟能详的重排和重绘。</p> <blockquote><p><strong><code>非常需要注意的一点是：一个元素的重排通常会带来一系列的反应，甚至触发整个文档所有元素的重排和重绘，性能代价是非常高昂的。</code></strong></p></blockquote> <p>如何查看元素是否有连锁的重绘？如何避免了？</p> <p>我们可以通过如下设置后操作页面，重绘的区域有绿色边框高亮显示。</p> <p><img src="/blog/assets/img/2.af753ac4.png" alt="performance"></p> <p>经过排查后发现主要有两种情况会引起页面的连锁重绘和重排，导致该页面滚动时卡顿：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>case1: box-shadow的阴影区域和固定定位有交叉关系时。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如左侧导航是固定定位，右侧是列表部分，列表的外层元素添加了box-shadow，
其阴影区域和固定定位有交叉时。滚动时固定定位会触发重绘，通过box-shadow，
间接的使右侧列表上所有元素都发生了重绘。</p> <p><code>修复：去掉该box-shadow属性后滚动列表非常顺畅。</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>case2: websocket实时更新列表中某行中某个元素的数据时，整个列表发生重绘。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>解决这个问题，要先了解web页面的层次问题。</p> <p>有两个因素造成了这个问题，其一是因为数据变化时使用了animation导致了同一层次的元素重绘</p> <p><code>修复方案一：删除该animation属性（因业务要求不可以取）</code></p> <p><code>修复方案二：在该元素上增加相对定位，设置一个唯一的z-index值。使元素有独立的层次，在浏览器渲染该元素时不会触发连锁重绘。</code></p> <p>在问题排查中可以通过如下设置降低CPU的速度测试问题：</p> <p><img src="/blog/assets/img/3.e1e68e55.png" alt="performance"></p> <blockquote><p><code>总之在开发过程中严谨的把控好自己的每一行代码，在面对复杂的问题时，多分析和查阅资料，当遇到性能瓶颈问题时，可以多用chrome devtool上的相关设置进行快速定位。</code></p></blockquote> <!----></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/wangtager/blog/edit/master/docs/performance/render.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">4/21/2020, 7:41:07 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/graph/animation.html" class="prev">
        动画的应用
      </a></span> <span class="next"><a href="/blog/sublime/sublime.html">
        Sublime 插件和配置文件的版本控制
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/blog/assets/js/app.639cd58a.js" defer></script><script src="/blog/assets/js/2.625d0afc.js" defer></script><script src="/blog/assets/js/4.3bde02cb.js" defer></script><script src="/blog/assets/js/5.ec6cd246.js" defer></script>
  </body>
</html>
